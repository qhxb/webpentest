//每点击一次发送这里执行一次
chrome.extension.onMessage.addListener(
function(request, sender, sendResponse) {
useragent = request.cmd;
sendResponse('Hello from background.');
if(useragent){
//跨域请求，把origin、Referer删除，重设User-Agent
chrome.webRequest.onBeforeSendHeaders.addListener(
    function(details){ 
        for(var i=0, headerLen=details.requestHeaders.length; i<headerLen; ++i){
            if(details.requestHeaders[i].name == 'Origin'||details.requestHeaders[i].name == 'origin'||details.requestHeaders[i].name == 'Referer'){
                details.requestHeaders.splice(i, 1);
                break;
            }
        }
        // details.requestHeaders.push({
        // name: 'User-Agent',
        // value: useragent
        // });  
        return {requestHeaders: details.requestHeaders};
    },
    {
        urls: [
            "<all_urls>"
        ]
    },
    [
        "blocking",
        "requestHeaders"
    ]
);
    }});
