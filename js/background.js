//跨域请求，把origin、Referer删除，重设User-Agent
var useragent = '';
chrome.webRequest.onBeforeSendHeaders.addListener(
    function(details){ 
        chrome.extension.onMessage.addListener(
        function(request, sender, sendResponse) {
        useragent = request.cmd;
    });
        for(var i=0, headerLen=details.requestHeaders.length; i<headerLen; ++i){
            if(details.requestHeaders[i].name == 'Origin'||details.requestHeaders[i].name == 'origin'||details.requestHeaders[i].name == 'Referer'||details.requestHeaders[i].name == 'User-Agent'){
                details.requestHeaders.splice(i, 1);
                break;
            }
        }
        console.log(details.requestHeaders[i].value);
        details.requestHeaders.push({
        name: 'User-Agent',
        value: useragent
        });  
        return {requestHeaders: details.requestHeaders};
    },
    {
        urls: [
            "<all_urls>"
        ]
    },
    [
        "blocking",
        "requestHeaders"
    ]
);
